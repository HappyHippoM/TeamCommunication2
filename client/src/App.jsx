import React,{useEffect,useState}from'react';import{io}from'socket.io-client';const SERVER=import.meta.env.VITE_SERVER||'http://localhost:4000';const socket=io(SERVER);export default function App(){const[connected,setConnected]=useState(false);const[name,setName]=useState('');const[role,setRole]=useState('');const[card,setCard]=useState([]);const[players,setPlayers]=useState([]);const[messages,setMessages]=useState({});const[reply,setReply]=useState({});const[guess,setGuess]=useState('');useEffect(()=>{socket.on('connect',()=>setConnected(true));socket.on('disconnect',()=>setConnected(false));socket.on('card',({role,card})=>{setRole(role);setCard(card);});socket.on('players',setPlayers);socket.on('private_message',({from,text})=>{setMessages(m=>({...m,[from]:[...(m[from]||[]),`${from}: ${text}`]}));});socket.on('game_result',({message})=>alert(message));},[]);const register=()=>{socket.emit('register',{name},res=>{if(!res.ok)return alert(res.error);setRole(res.role);});};const sendMessage=toRole=>{const text=reply[toRole];if(!text)return;socket.emit('send_message',{toRole,text},res=>{if(!res.ok)return alert(res.error);setMessages(m=>({...m,[toRole]:[...(m[toRole]||[]),`You: ${text}`]}));setReply(r=>({...r,[toRole]:''}));});};const submitGuess=()=>{socket.emit('submit_answer',{answer:guess},res=>{if(!res.ok)alert(res.error);else alert('Відповідь відправлена!');});};if(!role)return(<div style={{padding:20}}><h2>Реєстрація</h2><input placeholder='Ваше ім’я' value={name} onChange={e=>setName(e.target.value)}/><button onClick={register}>Увійти</button></div>);return(<div style={{padding:20}}><h2>Ваша роль: {role}</h2><div>Ваші фігури: {card.join(' ')}</div>{role!=='C'?(<div style={{marginTop:20}}><h3>Повідомлення до С</h3><div style={{border:'1px solid #ccc',padding:10,minHeight:60}}>{(messages['C']||[]).map((m,i)=><div key={i}>{m}</div>)}</div><input placeholder='Ваше повідомлення' value={reply['C']||''} onChange={e=>setReply({...reply,C:e.target.value})}/><button onClick={()=>sendMessage('C')}>Надіслати С</button></div>):(<div style={{marginTop:20}}><h3>Вхідні повідомлення</h3>{['A','B','D','E','F'].map(r=>(<div key={r} style={{border:'1px solid #ccc',marginTop:8,padding:8}}><strong>{r}</strong><div>{(messages[r]||[]).map((m,i)=><div key={i}>{m}</div>)}</div><input placeholder={`Відповідь ${r}`} value={reply[r]||''} onChange={e=>setReply({...reply,[r]:e.target.value})}/><button onClick={()=>sendMessage(r)}>Надіслати</button></div>))}<div style={{marginTop:20}}><h3>Відправити остаточну відповідь</h3><input placeholder='Спільна фігура' value={guess} onChange={e=>setGuess(e.target.value)}/><button onClick={submitGuess}>Надіслати відповідь</button></div></div>)}</div>);}